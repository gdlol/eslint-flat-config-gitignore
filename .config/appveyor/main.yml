version: 1.0.{build}
branches:
  only:
    - main
skip_tags: true
image: Ubuntu2004
environment:
  CODECOV_TOKEN: CODECOV_TOKEN
build_script:
  - sh: >-
      set -e

      npm install --global @devcontainers/cli

      devcontainer build --workspace-folder .
test_script:
  - sh: >-
      set -e

      devcontainer up --workspace-folder .

      devcontainer exec --workspace-folder . pnpm lint

      devcontainer exec --workspace-folder . --remote-env CI=true pnpm test

      devcontainer exec --workspace-folder . \
        --remote-env CI_PROVIDER=appveyor \
        --remote-env APPVEYOR_PULL_REQUEST_HEAD_COMMIT=${APPVEYOR_PULL_REQUEST_HEAD_COMMIT} \
        --remote-env APPVEYOR_URL=${APPVEYOR_URL} \
        --remote-env APPVEYOR_REPO_NAME=${APPVEYOR_REPO_NAME} \
        --remote-env APPVEYOR_BUILD_ID=${APPVEYOR_BUILD_ID} \
        --remote-env APPVEYOR_JOB_ID=${APPVEYOR_JOB_ID} \
        --remote-env APPVEYOR_ACCOUNT_NAME=${APPVEYOR_ACCOUNT_NAME} \
        --remote-env APPVEYOR_PROJECT_SLUG=${APPVEYOR_PROJECT_SLUG} \
        --remote-env APPVEYOR_BUILD_VERSION=${APPVEYOR_BUILD_VERSION} \
        --remote-env APPVEYOR_PULL_REQUEST_NUMBER=${APPVEYOR_PULL_REQUEST_NUMBER} \
        --remote-env APPVEYOR_REPO_BRANCH=${APPVEYOR_PULL_REQUEST_HEAD_REPO_BRANCH} \
        --remote-env CODECOV_TOKEN=${CODECOV_TOKEN} \
        pnpm codecov
